from imports import *

def login(arg):

  info = {'username': arg.username, 'password': arg.passw}
  res = requests.post('http://localhost:5000/login', data=info, verify=False)

  jsonres = res.json()
  #print(res.status_code)
  #print(jsonres)
  
  #print(home)
  if (res.status_code == 200):
    print(jsonres['token'])
    home = str(Path.home())
    f = open(home + '/softeng22API.token', 'w')
    f.write(jsonres['token'])
    f.close()
    print(f"Welcome back, {arg.username}! You have successfully logged in.")
    sys.exit(0)
  else:
        print(res.status_code)
        # print(res.text())
        # print(res)
        #data = res.json()
        # print(data)
  return True


parser = argparse.ArgumentParser()
parser.add_argument('--username', help='Enter username', required='TRUE')
parser.add_argument('--passw', help='Enter password', required='TRUE')
args = parser.parse_args()

login(args)